<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investor Dashboard</title>
    <link rel="stylesheet" href="../static/css/investor.css">
    <script>
        function calculateEquity(event, fundingGoal, totalEquity) {
            const amount = parseFloat(event.target.value) || 0;
            const equity = ((amount / fundingGoal) * totalEquity).toFixed(2);
            const equityDisplay = event.target.closest('form').querySelector('.calculated-equity');
            equityDisplay.textContent = equity > 0 ? `Calculated Equity: ${equity}%` : '';
        }
    </script>
</head>
<body>
    <header>
        <h1>Welcome, {{ name }}</h1>
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/logout">Logout</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- Section: Your Investments -->
        <h2>Your Investments</h2>
        <div id="investment-list">
            {% if user_investments %}
            {% for investment in user_investments %}
            <div class="project-card">
                <h3>{{ investment.project_title }}</h3>
                <p>{{ investment.project_description }}</p>
                <p>Amount Invested: ${{ investment.amount }}</p>
                <p>Equity Gained: {{ investment.equity_percentage }}%</p>
                <p>Status: {{ investment.status.title() }}</p>
                <p>Deadline: {{ investment.deadline }}</p>
            </div>
            {% endfor %}
            {% else %}
            <p>You haven't invested in any projects yet.</p>
            {% endif %}
        </div>

        <!-- Section: Explore Projects -->
        <h2>Explore Projects</h2>
        <div id="project-list">
            {% for project in projects %}
            <div class="project-card">
                <h3>{{ project.title }}</h3>
                <p>{{ project.description }}</p>
                <p>Funding Goal: ${{ project.funding_goal }}</p>
                <p>Current Funding: ${{ project.current_funding or 0 }}</p>
                <p>Total Equity Offered: {{ project.get('total_equity', 0) }}%</p>
                <p>Remaining Equity: {{ project.get('remaining_equity', project.get('total_equity', 0)) }}%</p>
                <p>Status: {{ project.get('status', 'active').title() }}</p>
                <p>Deadline: {{ project.deadline }}</p>

                {% if project.get('status', 'active') == 'active' and project.get('remaining_equity', 0) > 0 %}
                <form action="/invest/{{ project._id }}" method="POST">
                    <label for="investment">Investment Amount ($):</label>
                    <input 
                        type="number" 
                        name="investment" 
                        required 
                        min="1" 
                        placeholder="Enter amount to invest"
                        oninput="calculateEquity(event, {{ project.funding_goal }}, {{ project.get('total_equity', 0) }})">
                    
                    <p class="calculated-equity" style="color: green; font-weight: bold;"></p>
                    
                    <button type="submit">Invest</button>
                </form>
                {% else %}
                <p class="status-message">
                    {% if project.get('status', 'active') == 'completed' %}
                        Funding Goal Reached
                    {% elif project.get('remaining_equity', 0) <= 0 %}
                        No More Equity Available
                    {% endif %}
                </p>
                {% endif %}

                {% if project.get('investments', []) %}
                <div class="investment-history">
                    <h4>Investment History</h4>
                    <ul>
                    {% for investment in project.investments %}
                        <li>
                            Amount: ${{ investment.amount }} 
                            Equity: {{ investment.equity_percentage }}%
                        </li>
                    {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
            {% else %}
            <p>No projects available at the moment.</p>
            {% endfor %}
        </div>
    </main>
</body>
</html>
